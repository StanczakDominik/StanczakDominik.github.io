<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Particle in Cell methods | Plasma Non Stop</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://stanczakdominik.github.io/posts/particle-in-cell-methods/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Dominik Stańczak">
<link rel="prev" href="../first-dive-julia/" title="First dive into Julia" type="text/html">
<link rel="next" href="../on-the-recent-on-the-boris-solver-in-particle-in-cell-simulations-paper/" title='On the recent "On the Boris solver in Particle-in-cell simulations" paper' type="text/html">
<meta property="og:site_name" content="Plasma Non Stop">
<meta property="og:title" content="Particle in Cell methods">
<meta property="og:url" content="https://stanczakdominik.github.io/posts/particle-in-cell-methods/">
<meta property="og:description" content='I think it might finally be about time to do some plasma physics discussion on
this blog, stay true to the name and so on...
Basically the only actual "scientific" work I have actually done with plasm'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-03-19T10:00:00+01:00">
<meta property="article:tag" content="particle-in-cell">
<meta property="article:tag" content="pic">
<meta property="article:tag" content="plasma">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
<!-- Google custom search -->
<form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://stanczakdominik.github.io/">
</form>
<!-- End of custom search -->

            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="https://stanczakdominik.github.io/">

            <span id="blog-title">Plasma Non Stop</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="index.md" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages</a>
            <div class="dropdown-menu">
                    <a href="../../pages/about" class="dropdown-item">About</a>
                    <a href="../../pages/credits" class="dropdown-item">Credits</a>
                    <a href="../../pages/goal-progress" class="dropdown-item">Goal progress</a>
                    <a href="https://stanczakdominik.gitlab.io/vimwiki/" class="dropdown-item">Vimwiki</a>
            </div>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>
                </li>
<li class="nav-item">
<a href="https://github.com/StanczakDominik/stanczakdominik.github.io" class="nav-link">This site on GitHub</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Particle in Cell methods</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Dominik Stańczak
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-03-19T10:00:00+01:00" itemprop="datePublished" title="2019-03-19 10:00">2019-03-19 10:00</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/particle-in-cell-methods.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I think it might finally be about time to do some plasma physics discussion on
this blog, stay true to the name and so on...</p>
<p>Basically the only actual "scientific" work I have actually done with plasmas
up until now is writing a PIC simulation, PIC standing for Particle-in-Cell. I
thought I would take this opportunity to explain in my own words what the
concept is - I think it's a clever one.</p>
<!-- TEASER_END -->

<p>There are many reasons why you might want to simulate a plasma. Simulations are
often way cheaper than making a tokamak and causing the plasma to develop
turbulence, or sending out a probe to watch check solar flares for traces of
magnetic reconnection. There's also the case of needing simulations to
understand and explain your experimental results.
For now, however, let's just assume you have a burning
desire to make a few pretty plots and animations <a href="https://www.youtube.com/watch?v=Gj9mwAww3TM">like
these</a> using data that you don't
have simple access to via experiment.</p>
<p></p>
<center><iframe width="560" height="315" src="https://www.youtube.com/embed/Gj9mwAww3TM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></center>
<h2>Plasma simulation in general</h2>
<p>Plasmas are, in general, difficult to simulate. Many of the interesting
processes in plasmas that you would like to simulate occur far from
equilibrium, both spatial and thermal. For example, you'd like to simulate
interactions between a plasma and a laser pulse (this is, in fact, <a href="https://github.com/StanczakDominik/PythonPIC">what I did
for my engineering thesis</a>). This
is a massively non-equilibrium process. This mostly rules out fluid simulations
such as two-fluid and magnetohydrodynamics, which are based on averaging the <a href="https://en.wikipedia.org/wiki/Vlasov_equation">Vlasov
equation</a> over all possible
velocities. You could, in theory, use the Vlasov equation directly - but that's
a pretty darn high dimensional problem to be solving a PDE on (though something
I most certainly want to try my hand at, one of these days!).</p>
<p>Suppose you want to take another approach. Maybe you like your Newtonian, old
fashioned dynamical particle trajectory ODEs, you've dabbled in some N-body
simulations, maybe you've done a bit of molecular dynamics. You could imagine
putting a bunch of charged particles into a simulation, calculating forces
between those directly and letting them evolve over time.</p>
<p>Unfortunately, there is a major flaw in that plan. You've got long range
(Coulomb) $r^{-2}$ interactions between huge numbers of particles, so you
cannot use the neat trick common in molecular dynamics of only including a few
neighbor particles in your simulation. This means your simulation will scale as full
$O(N^2)$ in the number of particles if you do that
<a href="https://journals.aps.org/pre/abstract/10.1103/PhysRevE.98.033307">(though there have been attempts at doing that
recently)</a>.
I guess you could also try <a href="https://www.sciencedirect.com/science/article/pii/0010465594902275">a Barnes-Hut treecode of some sort, and that also appears to have been done</a> - that doesn't seem like
it's caught on, though, whatever the reason.</p>
<p>We've now set the stage and can move on to the main attraction...</p>
<h2>The particle in cell method</h2>
<p>The logic for a PIC is as follows, starting from the simple molecular dynamics
or N-body framework:</p>
<ol>
<li>If we were to know the force on each particle for every time step, we could
    <strong>push</strong> them - update their velocities and positions as usual, in $O(N)$
    steps. Each particle is assumed independent of others.</li>
<li>
<p>It's hard to calculate the forces directly in $O(N^2)$ steps. On the other
    hand, It's relatively easier to solve a PDE for the electromagnetic field
    given a charge and current distribution.  The particles we're moving are
    charged, so we can do the following translation:</p>
<ul>
<li>Particle positions $\implies$ charge distribution </li>
<li>Particle positions and velocities $\implies$ current distribution</li>
</ul>
<p>This means we could <strong>deposit</strong> the particles onto a grid or mesh by
some kind of interpolation.  We can also set the grid size so that many
particles go into a single grid cell: this implies that the number of grid
cells is much lower than our particle count. That, in turn, fits our
assumptions for plasmas<sup id="fnref-debye"><a class="footnote-ref" href="#fn-debye">1</a></sup>. A picture is worth a thousand words,
so here's a very basic example of a particle's charge with a linear
(triangular, and thus, centered on the middle) distribution being split
between three cells.</p>
<p></p>
<center>
  <img src="../../images/charge-deposition.svg" height="420" alt="Example of charge deposition">
</center>
</li>
<li>
<p>Once we have the charge and current distribution on our grid, we can use
    those quantities to <strong>solve</strong> Maxwell's equations for the electromagnetic field.
    You could, for example, use a spectral method or a relaxation algorithm,
    like conjugate gradients.</p>
</li>
<li>
<p>Once we know the fields at the grid cell locations, we can <strong>gather</strong> the
    field from those to the particle locations. Remember step 1, where we wished
    for forces - readily available given fields - at particle locations? Well,
    here we go, wish granted!</p>
</li>
<li>
<p><code>goto 1</code></p>
</li>
</ol>
<p>And that's it, the particle-in-cell method in a nutshell. Of course, logically
it makes more sense to start from 2. (as you would usually start your
simulation with a set of initial conditions for the particle positions,
velocities and maybe external fields), but to me it's cleaner narratively to think
of the algorithm in this order.</p>
<h3>The advantages</h3>
<ol>
<li>It's close to fundamental physics and thus understandable! You get a full
   picture of what each of the particles does, how the fields behave,
   while making very few assumptions.</li>
<li>It's lightning fast! The $O(N^2)$ force calculation is reduced to the
   complexity of your three replacement steps. While you can expect deposition
   and gathering to be roughly $O(Nm)$ ($m$ being the number of cells), $N$ is
   much larger than $m$, and the field solver is going to scale independently
   of $N$ - so that's still a massive gain over direct summation.</li>
<li>It's easy to parallelize! Each particle is essentially independent for the
   pushing step (as they only interact with each other via fields), so those
   movements are trivially parallel. Grid operations can also be done in
   parallel (though admittedly I haven't looked into that much, yet - I fully
   intend to do so).</li>
</ol>
<p>And of course, no description of a simulation method is complete without... </p>
<h3>The disadvantages</h3>
<ol>
<li>The method is mostly explicit, so that limits your time step and grid size
   quite a lot.  Otherwise, you get spurious instabilities.</li>
<li>Statistical noise makes life a pain when you're working on PIC simulations,
   precisely because you're modeling your large numbers of real particles with
   fewer virtual discrete ones. The trick seems to be increasing the particle
   numbers, but <a href="https://en.wikipedia.org/wiki/Particle-in-cell#Technical_aspects">Wikipedia
   claims</a>
   that this source of error is more figured out for traditional grid methods.
   In a way, this also means PICs are a prime target for GPUs, as exhibited by
   <a href="https://picongpu.readthedocs.io/en/0.4.3/index.html">PIConGPU</a>.</li>
</ol>
<p>Still, PICs are used in many awesome applications, such as plasma turbulence
research, and their parallelizability means they're only going to get more
important in the coming exascale computing era.</p>
<p>I'll be writing a few follow-up posts going over particular aspects of PIC
codes - tricks I've picked up along the way, etc. Stay tuned!</p>
<h5>References</h5>
<ul>
<li>
<a href="https://www.youtube.com/watch?v=Gj9mwAww3TM">Relativistic kinetic turbulence video</a> by 
  Joonas Nättilä, using the <a href="https://github.com/natj/plasmabox">plasmabox code</a>.</li>
<li>
<a href="https://github.com/StanczakDominik/PythonPIC">PythonPIC</a>, my less-than-amazing engineering thesis code.</li>
<li><a href="https://github.comnatj/plasmabox">Vlasov Equation - Wikipedia</a></li>
<li>
<a href="https://journals.aps.org/pre/abstract/10.1103/PhysRevE.98.033307">Plasma simulation via molecular dynamics example</a>.</li>
<li>
<a href="https://www.sciencedirect.com/science/article/pii/0010465594902275">Barnes-Hut plasma simulation example</a> </li>
<li><a href="https://en.wikipedia.org/wiki/Particle-in-cell">Particle in Cell applications - Wikipedia</a></li>
<li><a href="https://www.particleincell.com/2016/cuda-pic/">GPU PIC</a></li>
<li><a href="https://picongpu.readthedocs.io/en/0.4.3/index.html">PIConGPU</a></li>
</ul>
<div class="footnote">
<hr>
<ol>
<li id="fn-debye">
<p>If you want to learn more about those, I don't feel like I can give
  this subject justice better than chapter 1-1 of Birdsall and Langdon's
  seminal <em>Plasma Physics via Computer Simulation</em> text. <a class="footnote-backref" href="#fnref-debye" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/particle-in-cell/" rel="tag">particle-in-cell</a></li>
            <li><a class="tag p-category" href="../../categories/pic/" rel="tag">pic</a></li>
            <li><a class="tag p-category" href="../../categories/plasma/" rel="tag">plasma</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../first-dive-julia/" rel="prev" title="First dive into Julia">Previous post</a>
            </li>
            <li class="next">
                <a href="../on-the-recent-on-the-boris-solver-in-particle-in-cell-simulations-paper/" rel="next" title='On the recent "On the Boris solver in Particle-in-cell simulations" paper'>Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="stanczakdominik-github-io",
            disqus_url="https://stanczakdominik.github.io/posts/particle-in-cell-methods/",
        disqus_title="Particle in Cell methods",
        disqus_identifier="cache/posts/particle-in-cell-methods.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article><script>var disqus_shortname="stanczakdominik-github-io";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2019         <a href="mailto:stanczakdominik@gmail.com">Dominik Stańczak</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a> - 
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
