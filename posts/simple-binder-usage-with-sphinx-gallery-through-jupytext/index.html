<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simple Binder usage with Sphinx-Gallery through Jupytext | Prematurely optimizing</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://stanczakdominik.github.io/posts/simple-binder-usage-with-sphinx-gallery-through-jupytext/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett">
<link rel="stylesheet" type="text/css" href="../../assets/css/tipuesearch.css">
<meta name="author" content="Dominik Stańczak">
<link rel="prev" href="../post-mortem-for-my-engineering-thesis-code-pythonpic/" title="Post mortem for my engineering thesis code, PythonPIC" type="text/html">
<link rel="next" href="../distance-matrix-numba/" title="Better Numba calculation of inter-particle distance matrices" type="text/html">
<meta property="og:site_name" content="Prematurely optimizing">
<meta property="og:title" content="Simple Binder usage with Sphinx-Gallery through Jupytext">
<meta property="og:url" content="https://stanczakdominik.github.io/posts/simple-binder-usage-with-sphinx-gallery-through-jupytext/">
<meta property="og:description" content="It's been a busy week for PlasmaPy. I recently found out about Binder support in sphinx-gallery. The latter is a package that we use to
turn python scripts with comments into Sphinx pages and Jupyter ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-07-06T16:00:00+02:00">
<meta property="article:tag" content="maintenance">
<meta property="article:tag" content="plasmapy">
<meta property="article:tag" content="python">
<meta property="article:tag" content="sphinx">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">Prematurely optimizing</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages</a>
            <div class="dropdown-menu">
                    <a href="../../about" class="dropdown-item">About</a>
                    <a href="../../credits" class="dropdown-item">Acknoledgments</a>
            </div>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Posts by tag</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link"><img alt="RSS feed" height="24" width="24" style="border-width:0; margin-bottom:12px;" src="../../images/rss.png"></a>
                </li>
<li class="nav-item">
<a href="https://github.com/StanczakDominik/stanczakdominik.github.io/tree/src" class="nav-link"><img alt="GitHub" height="24" width="24" style="border-width:0; margin-bottom:12px;" src="../../images/GitHub-Mark-64px.png"></a>

                
            </li>
</ul>
<form class="navbar-form navbar-left" action="../../search/" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Search" autocomplete="off">
</div>
</form>


            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.rst" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Simple Binder usage with Sphinx-Gallery through Jupytext</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Dominik Stańczak
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-07-06T16:00:00+02:00" itemprop="datePublished" title="2019-07-06 16:00">2019-07-06 16:00</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/simple-binder-usage-with-sphinx-gallery-through-jupytext.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>It's been a busy week for <a class="reference external" href="https://github.com/PlasmaPy/PlasmaPy/">PlasmaPy</a>. I recently found out about Binder support in <a class="reference external" href="https://sphinx-gallery.github.io/">sphinx-gallery</a>. The latter is a package that we use to
turn python scripts with comments into Sphinx pages and Jupyter Notebooks. I figured adding that could be a nice fit for <a class="reference external" href="http://docs.plasmapy.org/en/stable/auto_examples/index.html">our existing example gallery</a> .</p>
<p>However, I quickly realized that the system in place is a bit unwieldy. Binder takes a link to an existing GitHub repository and executes <code class="docutils literal">.ipynb</code> notebooks located there online. However, with sphinx-gallery, we don't have those notebooks in the repository - we have <code class="docutils literal">.py</code> files with comments. <a class="reference external" href="https://sphinx-gallery.github.io/configuration.html#binder-links">The currently recommended way of setting this up with sphinx-gallery</a> is keeping your built documentation in <a class="reference external" href="https://github.com/sphinx-gallery/sphinx-gallery.github.io">another repository</a> and hosting it via something along the lines of GitHub Pages rather than <a class="reference external" href="https://readthedocs.org/">ReadTheDocs</a>, which we are currently using.</p>
<p><a class="reference external" href="https://github.com/sphinx-gallery/sphinx-gallery/pull/505/files">I added the results of this investigation to sphinx-gallery's docs</a>, but I didn't want to switch away from RTD, so I figured I'd go ahead and find another way. I think I've got something that works well enough now!</p>
<p>Trigger warning: later on during this post, there may be monkeypatching of sphinx_gallery internals. Beware.</p>
<!-- TEASER_END -->
<div class="section" id="using-jupytext">
<h2>Using Jupytext</h2>
<p><a class="reference external" href="https://github.com/mwouts/jupytext/">The Jupytext project</a> is kind of like <a class="reference external" href="https://github.com/jupyter/nbconvert">nbconvert</a>, but two-way. It lets you turn notebooks into scripts and vice versa. The interesting thing is that, <a class="reference external" href="https://jupytext.readthedocs.io/en/latest/formats.html#sphinx-gallery-scripts">as per Jupytext's documentation</a>, it is possible to let Binder's jupyter instance parse sphinx-gallery style <code class="docutils literal">.py</code> files as jupyter notebooks. This was done in <a class="reference external" href="https://github.com/PlasmaPy/PlasmaPy/pull/656/files">PlasmaPy#656</a> . First, let's instruct the in-binder Jupyter instance to parse <code class="docutils literal">.py</code> files in <code class="docutils literal">.jupyter/jupyter_notebook_config.py</code> via blatant copy-paste:</p>
<pre class="code python"><a name="rest_code_d98fc62e87094d42a03f59269fa8f80c-1"></a><span class="n">c</span><span class="o">.</span><span class="n">NotebookApp</span><span class="o">.</span><span class="n">contents_manager_class</span> <span class="o">=</span> <span class="s2">"jupytext.TextFileContentsManager"</span>
<a name="rest_code_d98fc62e87094d42a03f59269fa8f80c-2"></a><span class="n">c</span><span class="o">.</span><span class="n">ContentsManager</span><span class="o">.</span><span class="n">preferred_jupytext_formats_read</span> <span class="o">=</span> <span class="s2">"py:sphinx"</span>
<a name="rest_code_d98fc62e87094d42a03f59269fa8f80c-3"></a><span class="n">c</span><span class="o">.</span><span class="n">ContentsManager</span><span class="o">.</span><span class="n">sphinx_convert_rst2md</span> <span class="o">=</span> <span class="kc">True</span>
</pre>
<p>And then let's also add a <code class="docutils literal">binder/requirements.txt</code> file that lets Binder know what Python packages to download while building the repository's image. The version I had there was pretty shoddy, as CI/<code class="docutils literal">setup.py</code>/packaging errors surfaced while I was tinkering with this. Long story short, something like this should do:</p>
<pre class="code text"><a name="rest_code_eae08700e52e4359901e239d8dc6a257-1"></a>-r ../requirements/automated-documentation-tests.txt
<a name="rest_code_eae08700e52e4359901e239d8dc6a257-2"></a>jupytext
<a name="rest_code_eae08700e52e4359901e239d8dc6a257-3"></a>.
</pre>
<p>Where, in didactic order:</p>
<ul class="simple">
<li><p><code class="docutils literal">jupytext</code> should be pretty self-explanatory,</p></li>
<li><p><code class="docutils literal">.</code> is the repository's package itself (here, PlasmaPy), as accessed by <code class="docutils literal">setup.py</code></p></li>
<li><p><code class="docutils literal"><span class="pre">-r</span> <span class="pre">../requirements/automated-documentation-tests.txt</span></code> reads a pip requirements file specifying our documentation requirements. I think with a proper <code class="docutils literal">extras_require</code> specified in <code class="docutils literal">setup.py</code>, these two lines could be collapsed simply into <code class="docutils literal">.[dev]</code> or some such. Note that <code class="docutils literal"><span class="pre">-r</span></code> takes a path relative to the file, thus the <code class="docutils literal">../</code></p></li>
</ul>
<p>At this point all this really is is implementing what's mentioned in Jupytext's docs. The result is as follows:</p>
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/PlasmaPy/PlasmaPy/master?filepath=plasmapy%2Fexamples"><img alt="https://mybinder.org/badge_logo.svg" class="align-center" src="https://mybinder.org/badge_logo.svg"></a>
<p>But you might notice an inconsistency in the Sphinx-rendered gallery itself: even if we were to <a class="reference external" href="https://sphinx-gallery.github.io/configuration.html#binder-links">configure docs to display Binder links</a> they will point to a path as imagined by the current implementation in Sphinx-Gallery, such as:</p>
<pre class="code text"><a name="rest_code_915ae2a72be7442381fffd2fd6ca839c-1"></a>https://gke.mybinder.org/v2/gh/PlasmaPy/PlasmaPy/master?filepath=plasmapy/examples/auto_examples/plot_physics.ipynb
</pre>
<p>Note the spurious <code class="docutils literal">auto_examples</code> directory supposedly including an <code class="docutils literal">.ipynb</code> file. This obviously doesn't work for our use case, so we'd like to be able to change the generated links somehow...</p>
</div>
<div class="section" id="monkeypatching">
<h2>Monkeypatching</h2>
<p>This (or rather, <a class="reference external" href="https://github.com/PlasmaPy/PlasmaPy/pull/658/files">PlasmaPy#658</a> ) is where it gets dirty. The solution developed in cooperation with Stuart Mumford (of SunPy fame, who contributed the idea which I implemented) is monkeypatching sphinx-gallery's link generation code. It's simple, yet effective.</p>
<p>Let's use this config for <code class="docutils literal"><span class="pre">sphinx-gallery</span></code>:</p>
<pre class="code python"><a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-1"></a><span class="n">sphinx_gallery_conf</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-2"></a>        <span class="c1"># path to your examples scripts</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-3"></a>        <span class="s1">'examples_dirs'</span><span class="p">:</span> <span class="s1">'../plasmapy/examples'</span><span class="p">,</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-4"></a>        <span class="c1"># path where to save gallery generated examples</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-5"></a>        <span class="s1">'backreferences_dir'</span><span class="p">:</span> <span class="s1">'gen_modules/backreferences'</span><span class="p">,</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-6"></a>        <span class="s1">'gallery_dirs'</span><span class="p">:</span> <span class="s1">'auto_examples'</span><span class="p">,</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-7"></a>        <span class="s1">'binder'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-8"></a>                <span class="s1">'org'</span><span class="p">:</span> <span class="s1">'PlasmaPy'</span><span class="p">,</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-9"></a>                <span class="s1">'repo'</span><span class="p">:</span> <span class="s1">'PlasmaPy'</span><span class="p">,</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-10"></a>                <span class="s1">'branch'</span><span class="p">:</span> <span class="s1">'master'</span><span class="p">,</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-11"></a>                <span class="s1">'binderhub_url'</span><span class="p">:</span> <span class="s1">'https://mybinder.org'</span><span class="p">,</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-12"></a>                <span class="s1">'dependencies'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'../binder/requirements.txt'</span><span class="p">],</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-13"></a>                <span class="s1">'notebooks_dir'</span><span class="p">:</span> <span class="s1">'plasmapy/examples'</span><span class="p">,</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-14"></a>        <span class="p">}</span>
<a name="rest_code_6f736a78c22241879b9508ba1e8c63b3-15"></a><span class="p">}</span>
</pre>
<p>and add this fragment of <code class="docutils literal">sphinx_gallery.binder</code> code with a modification into Sphinx's <code class="docutils literal">conf.py</code> file:</p>
<pre class="code python"><a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-1"></a><span class="c1"># Patch sphinx_gallery.binder.gen_binder_rst so as to point to .py file in repository</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-2"></a><span class="kn">import</span> <span class="nn">sphinx_gallery.binder</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-3"></a><span class="k">def</span> <span class="nf">patched_gen_binder_rst</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">binder_conf</span><span class="p">,</span> <span class="n">gallery_conf</span><span class="p">):</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-4"></a>    <span class="sd">"""Generate the RST + link for the Binder badge.</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-5"></a><span class="sd">    ...</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-6"></a><span class="sd">    """</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-7"></a>    <span class="n">binder_conf</span> <span class="o">=</span> <span class="n">sphinx_gallery</span><span class="o">.</span><span class="n">binder</span><span class="o">.</span><span class="n">check_binder_conf</span><span class="p">(</span><span class="n">binder_conf</span><span class="p">)</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-8"></a>    <span class="n">binder_url</span> <span class="o">=</span> <span class="n">sphinx_gallery</span><span class="o">.</span><span class="n">binder</span><span class="o">.</span><span class="n">gen_binder_url</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">binder_conf</span><span class="p">,</span> <span class="n">gallery_conf</span><span class="p">)</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-9"></a>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-10"></a>    <span class="c1"># I added the line below:</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-11"></a>    <span class="n">binder_url</span> <span class="o">=</span> <span class="n">binder_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">gallery_conf</span><span class="p">[</span><span class="s1">'gallery_dirs'</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"ipynb"</span><span class="p">,</span> <span class="s2">"py"</span><span class="p">)</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-12"></a>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-13"></a>    <span class="n">rst</span> <span class="o">=</span> <span class="p">(</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-14"></a>            <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-15"></a>            <span class="s2">"  .. container:: binder-badge</span><span class="se">\n\n</span><span class="s2">"</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-16"></a>            <span class="s2">"    .. image:: https://mybinder.org/badge_logo.svg</span><span class="se">\n</span><span class="s2">"</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-17"></a>            <span class="s2">"      :target: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">"</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-18"></a>            <span class="s2">"      :width: 150 px</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">binder_url</span><span class="p">)</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-19"></a>    <span class="k">return</span> <span class="n">rst</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-20"></a>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-21"></a><span class="c1"># And then we finish our monkeypatching misdeed by redirecting sphinx-gallery to use our function:</span>
<a name="rest_code_ff6b2c592b65459ba74edb21306fbcbe-22"></a><span class="n">sphinx_gallery</span><span class="o">.</span><span class="n">binder</span><span class="o">.</span><span class="n">gen_binder_rst</span> <span class="o">=</span> <span class="n">patched_gen_binder_rst</span>
</pre>
<p>The current gallery is located <a class="reference external" href="http://docs.plasmapy.org/en/latest/auto_examples/index.html">here</a>, and an example link is <a class="reference external" href="https://mybinder.org/v2/gh/PlasmaPy/PlasmaPy/master?filepath=plasmapy/examples/particle_stepper.py">https://mybinder.org/v2/gh/PlasmaPy/PlasmaPy/master?filepath=plasmapy/examples/particle_stepper.py</a> - and you should instantly see it points to the right spot!</p>
<p>Obviously, it would be better to implement such link customization in sphinx-gallery itself somehow, but it's up to their maintainers to decide whether this kind of combo usage with Jupytext is in scope for their project. For now, the monkeypatch solution works decently. I'll try to update this post if that comes about.</p>
</div>
<div class="section" id="update-requirements">
<h2>Update - requirements</h2>
<p><a class="reference external" href="https://github.com/PlasmaPy/PlasmaPy/pull/689">@jdkent on GitHub</a> suggests that if the above doesn't work for you, you should make sure the Sphinx version you're using is 2 or newer.</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/maintenance/" rel="tag">maintenance</a></li>
            <li><a class="tag p-category" href="../../categories/plasmapy/" rel="tag">plasmapy</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/sphinx/" rel="tag">sphinx</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../post-mortem-for-my-engineering-thesis-code-pythonpic/" rel="prev" title="Post mortem for my engineering thesis code, PythonPIC">Previous post</a>
            </li>
            <li class="next">
                <a href="../distance-matrix-numba/" rel="next" title="Better Numba calculation of inter-particle distance matrices">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="stanczakdominik-github-io",
            disqus_url="https://stanczakdominik.github.io/posts/simple-binder-usage-with-sphinx-gallery-through-jupytext/",
        disqus_title="Simple Binder usage with Sphinx-Gallery through Jupytext",
        disqus_identifier="cache/posts/simple-binder-usage-with-sphinx-gallery-through-jupytext.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="stanczakdominik-github-io";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2020         <a href="mailto:stanczakdominik@gmail.com">Dominik Stańczak</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a> - 
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="../../images/creativecommons.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
